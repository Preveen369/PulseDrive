{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile within the PulseDrive application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile.",
          "format": "uuid"
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Full name of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "name",
        "createdAt"
      ]
    },
    "StressData": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StressData",
      "type": "object",
      "description": "Represents a single instance of stress data recorded for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stress data record.",
          "format": "uuid"
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N StressData)"
        },
        "stressLevel": {
          "type": "number",
          "description": "The measured stress level. (Likely a normalized value or index)"
        },
        "heartRate": {
          "type": "number",
          "description": "The measured heart rate in beats per minute (BPM)."
        },
        "fatigueStatus": {
          "type": "string",
          "description": "The user's fatigue status.",
          "enum": ["active", "sleepy", "fatigue", "sleeping"]
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the stress level was recorded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "stressLevel",
        "heartRate",
        "fatigueStatus",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Uses path-based ownership: only the user with matching {userId} can access. Includes denormalized 'userId' in the path for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/stress_data/{stressDataId}",
        "definition": {
          "entityName": "StressData",
          "schema": {
            "$ref": "#/backend/entities/StressData"
          },
          "description": "Stores stress data records associated with a user. Uses path-based ownership: only the user with matching {userId} can access. Includes denormalized 'userId' in the path for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "stressDataId",
              "description": "The unique identifier of the stress data record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to securely store user profiles and stress data for the PulseDrive application. The structure prioritizes authorization independence and supports efficient querying. Path-based ownership is used for private user data, ensuring that only the user can access their own stress data.\n\n*   `/users/{userId}/profile`: Stores user profile information. This collection uses path-based ownership, meaning that only the authenticated user with the matching `userId` can access this document.\n*   `/users/{userId}/stress_data/{stressDataId}`: Stores stress data records associated with a user. This collection also uses path-based ownership. Each stress data document includes the `userId`, ensuring that security rules can verify that the authenticated user matches the `userId` in the document.\n\n**Authorization Independence:** The structure ensures authorization independence by using path-based ownership for user-specific data. Security rules can directly check `request.auth.uid` against the `userId` in the document path or within the document itself, without needing to perform additional `get()` operations to retrieve parent document data.\n\n**QAPs Support:** The structure supports secure `list` operations by organizing data into user-specific subcollections. Security rules can allow listing documents within `/users/{userId}/stress_data` only if `request.auth.uid == userId`, preventing unauthorized access to other users' data. The separation of data into subcollections based on ownership ensures that rules do not act as filters, as each collection inherently contains data with the same access requirements."
  }
}